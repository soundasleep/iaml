<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>Coverage: CreateDomainStorePhp.xpt</title>
	<link rel="stylesheet" type="text/css" href="default.css" />
</head>
<body>

<h1>CreateDomainStorePhp.xpt</h1>

<a href="index.html">Summary</a>

<ul id="legend">
	<li class="none">Never executed</li>
	<li class="oaw">Generated output</li>
	<li class="php">Executed on server (PHP)</li>
	<li class="js">Executed on client (Javascript)</li>
</ul>

<p><pre>«IMPORT iaml»

«EXTENSION template::GeneratorExtensions»

<span class="oaw php " title="9 steps in OAW 23 steps in PHP (C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 5:DEFINE createDomainStorePhp FOR model::DomainStore)"><a name="createDomainStorePhp.html">«DEFINE createDomainStorePhp FOR model::DomainStore»</a>
	// DomainStore «type» "«name»"
	<span class="oaw " title="5 steps in OAW (C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 7:IF isPropertiesFile(this))">«IF isPropertiesFile(this)»
		<a href="#createDomainStoreProperties.html">«EXPAND createDomainStoreProperties FOR this»</a>
	</span><span class="oaw " title="4 steps in OAW (C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 9:ELSE)">«ELSE»
		<a href="#createDomainStoreDatabase.html">«EXPAND createDomainStoreDatabase FOR this»</a>
	«ENDIF»</span>
«ENDDEFINE»</span>

/**
 * PHP code for creating the domain store.
 */
<span class="oaw " title="4 steps in OAW (C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 17:DEFINE createDomainStoreDatabase FOR model::DomainStore)"><a name="createDomainStoreDatabase.html">«DEFINE createDomainStoreDatabase FOR model::DomainStore»</a>
	// first, make sure the table exists
	$db = new PDO('sqlite:«safeName()».db') or throw_new_IamlRuntimeException("could not open db '«safeName()».db'");
	
	// now cycle through all DomainObjects in this DomainStore to create each of them
	<a href="#createDomainObjectDatabase.html">«EXPAND createDomainObjectDatabase FOREACH children»</a>

	// sole attributes
	<span class="none" title="(C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 25:IF attributes.size &gt; 0)">«IF attributes.size &gt; 0»
		$s = $db-&gt;prepare("SELECT * FROM single_values");
		if (!$s) {
			// create the table
			$q = $db-&gt;query("CREATE TABLE single_values (
					<a href="#createDomainAttributeDatabase.html">«EXPAND createDomainAttributeDatabase FOREACH attributes SEPARATOR ", "»</a>
				);") or throw_new_IamlRuntimeException("could not create single_values table: " . print_r($db-&gt;errorInfo(), true));
		}	
	«ENDIF»</span>
	
	// close connection
	$db = null;
«ENDDEFINE»</span>

<span class="oaw " title="5 steps in OAW (C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 39:DEFINE createDomainStoreProperties FOR model::DomainStore)"><a name="createDomainStoreProperties.html">«DEFINE createDomainStoreProperties FOR model::DomainStore»</a>
	// we don't need to create anything, it is handled automatically
«ENDDEFINE»</span>

/**
 * Expand a DomainObject into a SQL table.
 */ 
<span class="oaw php " title="5 steps in OAW 16 steps in PHP (C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 46:DEFINE createDomainObjectDatabase FOR model::DomainObject)"><a name="createDomainObjectDatabase.html">«DEFINE createDomainObjectDatabase FOR model::DomainObject»</a>
	$s = $db-&gt;prepare("SELECT * FROM «safeNameString(name)»");
	if (!$s) {
		// create the table
		$q = $db-&gt;query("CREATE TABLE «safeNameString(name)» (
				<a href="#createDomainAttributeDatabase.html">«EXPAND createDomainAttributeDatabase FOREACH attributes SEPARATOR ", "»</a>
			);") or throw_new_IamlRuntimeException("could not create table: " . print_r($db-&gt;errorInfo(), true));
	}
«ENDDEFINE»</span>

/* if an InternetApplication directly contains an AbstractObject,
   we still process it anyway. we will assume it is stored
   inside a database. */
<span class="oaw php " title="28 steps in OAW 202 steps in PHP (C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 59:DEFINE createDomainObjectPhp_Root FOR model::ApplicationElement)"><a name="createDomainObjectPhp_Root.html">«DEFINE createDomainObjectPhp_Root FOR model::ApplicationElement»</a>
«ENDDEFINE»</span>

<span class="oaw php " title="1 steps in OAW 1 steps in PHP (C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 62:DEFINE createDomainObjectPhp_Root FOR model::DomainObject)"><a name="createDomainObjectPhp_Root.html">«DEFINE createDomainObjectPhp_Root FOR model::DomainObject»</a>
	// first, make sure the table exists
	$db = new PDO('sqlite:internet_application.db') or throw_new_IamlRuntimeException("could not open db '«safeName()».db'");
	
	// now cycle through this DomainObject
	<a href="#createDomainObjectDatabase.html">«EXPAND createDomainObjectDatabase FOR this»</a>
	
	// close connection
	$db = null;
«ENDDEFINE»</span>

<span class="none" title="(C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 73:DEFINE createDomainObjectProperties_Root FOR model::DomainObject)"><a name="createDomainObjectProperties_Root.html">«DEFINE createDomainObjectProperties_Root FOR model::DomainObject»</a>
	// we don't need to create anything, it is handled automatically
«ENDDEFINE»</span>

/**
 * Expand a DomainAttribute into a SQL row.
 */
<span class="oaw " title="10 steps in OAW (C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 80:DEFINE createDomainAttributeDatabase FOR model::DomainAttribute)"><a name="createDomainAttributeDatabase.html">«DEFINE createDomainAttributeDatabase FOR model::DomainAttribute»</a>
	«safeNameString(name)» VARCHAR(255) NULL
«ENDDEFINE»</span>

<span class="none" title="(C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\CreateDomainStorePhp.xpt: 84:DEFINE exception FOR Object)"><a name="exception.html">«DEFINE exception FOR Object»</a>
«ENDDEFINE»</span></pre></p>

</body>
</html>