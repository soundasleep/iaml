<html><style>body,html,th,td{font-family:Arial;}.none{background:#fcc;}.oaw{background:#ffc;}.php{color:green;}pre{background:#eee;border:1px solid #666;}</style><body><h1>C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\includes\StoreEventsPhp.xpt</h1>

<a href="index.html">Summary</a><ul><li class="none">no execution</li><li class="oaw">OAW execution</li><li class="php">PHP execution</li></ul>

<p><pre>«IMPORT iaml»

«EXTENSION template::GeneratorExtensions»

<span class="oaw " title="82 steps in OAW (C:\Documents and Settings\jmwright.MASSEY\workspace-iaml\org.openiaml.model.codegen.oaw\src\template\php\includes\StoreEventsPhp.xpt: 5:DEFINE storeEventsPhp FOR model::InternetApplication-)"><a name="storeEventsPhp.html">«DEFINE storeEventsPhp FOR model::InternetApplication-»</a>
&lt;?php

function log_message($msg) {
	$fp = fopen("php.log", "a");
	fwrite($fp, date("Y-m-d H:i:s") . " store_events.php: $msg\n");
	fclose($fp);
}

log_message("store_event.php? " . print_r($_GET, true));
$page_id = $_GET["page_id"] or throw_new_IamlRuntimeException("no page id");
$event_name = $_GET["event_name"] or throw_new_IamlRuntimeException("no event name");
$arg0 = $_GET["arg0"] or throw_new_IamlRuntimeException("no arg0");

// first, make sure the table exists
$db = new PDO('sqlite:stored_events.db') or die("could not open db");
$s = $db-&gt;prepare("SELECT * FROM stored_events");
if (!$s) {
	// create the table
	// SQLite requires the field to be "INTEGER PRIMARY KEY AUTOINCREMENT" exactly
	// ref: http://www.sqlite.org/autoinc.html
	$q = $db-&gt;query("CREATE TABLE stored_events (
			id INTEGER PRIMARY KEY AUTOINCREMENT,
			page_id VARCHAR(64) NOT NULL,
			event_name VARCHAR(64) NOT NULL,
			arg0 BLOB
		);") or die("could not create table: " . print_r($db-&gt;errorInfo(), true));
}

// then insert it
$s = $db-&gt;prepare("INSERT INTO stored_events (page_id, event_name, arg0) VALUES (?, ?, ?)") or die("could not prepare query: " . print_r($db-&gt;errorInfo(), true));
$s-&gt;execute(array($page_id, $event_name, $arg0)) or die("could not execute insert query: " . print_r($db-&gt;errorInfo(), true));
$s = null;
log_message("adding page_id=$page_id, event_name=$event_name, arg0=$arg0");

echo "ok";

«ENDDEFINE»</span>
</pre></p></html>